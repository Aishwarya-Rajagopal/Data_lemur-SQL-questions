"""
Domain   : SQL
Author    : Aishwarya Rajagopal
Level     : Medium
"""
Problem 1: https://datalemur.com/questions/sql-highest-grossing
with cte as(
SELECT category,product,sum(spend) as total_spend ,
rank() over(PARTITION by category order BY sum(spend) DESC ) as ranking
FROM product_spend
where EXTRACT(YEAR FROM transaction_date) = 2022
group by category,product
)
select category,product,total_spend
from cte
where ranking <3
order by category,ranking
;

Problem 2 :https://datalemur.com/questions/sql-second-highest-salary

soln 1 : 
SELECT salary
FROM employee
order by salary desc
limit 1 OFFSET 1;

soln 2:
SELECT max(salary)
FROM employee
where salary < (SELECT max(salary)
FROM employee);

Problem 3: https://datalemur.com/questions/sql-top-three-salaries

with cte1 as(
SELECT department_name,	name,	salary ,
dense_rank() over (partition by department_name order by salary desc) as ranking
FROM employee e
left join department d
on e.department_id = d.department_id)

select department_name,	name,	salary
from cte1
where ranking <= 3
order by department_name asc,salary desc,	name asc	;

Problem 4: https://datalemur.com/questions/signup-confirmation-rate

SELECT round(count(t.email_id)::DECIMAL/count(e.email_id),2) as confirm_rate
FROM emails e
left join texts t
on e.email_id = t.email_id and signup_action='Confirmed';


Problem 5: https://datalemur.com/questions/rolling-average-tweets

SELECT user_id,	tweet_date,	
round(avg(tweet_count) over(partition by user_id order by tweet_date
rows between 2 preceding and current row),2) as rolling_avg_3d
FROM tweets;

Problem 6: https://datalemur.com/questions/sql-third-transaction

with cte as (SELECT user_id,	spend	,transaction_date ,
row_number() over (partition by user_id order by transaction_date) as trip_no
FROM transactions)
select user_id,	spend	,transaction_date
from cte
where trip_no = 3;

Problem 7:
Problem 8:
Problem 9:
Problem 10:
Problem 11:
Problem 12:
